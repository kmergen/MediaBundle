{# _media_dashboard.html.twig #}

<div class="kmm-dashboard-container"
     data-controller="media-upload"
     data-media-upload-max-files-value="{{ options.maxFiles }}"
     data-media-upload-max-file-size-value="{{ options.maxFileSize }}"
     data-media-upload-min-width-value="{{ options.minWidth }}"
     data-media-upload-min-height-value="{{ options.minHeight }}"
     data-media-upload-allowed-mime-types-value="{{ options.allowedMimeTypes|json_encode|e("html_attr") }}"
     data-media-upload-context-value="{{ options.context }}"
     data-media-upload-initial-images-value="{{ options.images|json_encode|e("html_attr") }}"
     data-media-upload-album-id-value="{{ options.albumId }}"
     data-media-upload-auto-save-value="{{ options.autoSave ? 'true' : 'false' }}"
     data-media-upload-temp-key-value="{{ options.tempKey }}"
     data-media-upload-image-variants-value="{{ options.imageVariants|json_encode|e("html_attr") }}"
     data-media-upload-editable-alt-text-locales-value="{{ options.editableAltTextLocales ? options.editableAltTextLocales|join(",") : '' }}"
     data-media-upload-translations-value="{{ options.translations|json_encode|e("html_attr") }}"
     data-media-upload-csrf-value="{{ csrf_token("media_delete") }}">

       <div class="{{ options.compact ? 'kmm-compact-wrapper' : '' }}">

              {# 1. PREVIEW LIST #}
              <div data-media-upload-target="previewList"
                   class="{{ options.compact ? 'kmm-preview-compact' : 'kmm-dashboard-preview-grid' }}"></div>

              {# 2. TRIGGER / DROPZONE #}
              <div data-media-upload-target="dropzone"
                   data-action="click->media-upload#onDropzoneClick dragover->media-upload#onDragOver dragleave->media-upload#onDragLeave drop->media-upload#onDrop"
                   class="{{ options.compact ? 'kmm-btn-upload-trigger' : 'kmm-dashboard-dropzone' }}"
                   title="{{ options.compact ? 'button.upload_image'|trans({}, 'KmMedia') : '' }}">

                     <div class="{{ options.compact ? '' : 'kmm-dropzone-info' }}">
                            <svg class="{{ options.compact ? '' : 'kmm-dropzone-info-svg' }}"
                                 fill="none"
                                 stroke="currentColor"
                                 viewbox="0 0 24 24">
                                   <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12">
                                   </path>
                            </svg>

                            {# Text only appears in full dashboard mode #}
                            {% if not options.compact %}
                                   <span class="kmm-dropzone-info-text">{{ 'dashboard.dropzone_help'|trans({}, 'KmMedia') }}</span>
                            {% endif %}
                     </div>
                     <input type="file"
                            data-media-upload-target="input"
                            data-action="change->media-upload#onFileChange"
                            multiple
                            accept="image/*"
                            class="hidden">
              </div>

              <div data-media-upload-target="errorBox" class="kmm-error-box kmm-hidden"></div>
       </div>
       {# 3. Media_ids) #}
       <input type="hidden"
              data-media-upload-target="mediaIds"
              name="{{ options.mediaInputPrefix ? options.mediaInputPrefix ~ '[ids]' : 'mediaIds' }}"
              value="">

       {# 4. Die Album ID #}
       <input type="hidden"
              data-media-upload-target="albumId"
              name="{{ options.mediaInputPrefix ? options.mediaInputPrefix ~ '[albumId]' : 'mediaAlbumId' }}"
              value="{{ options.albumId|default("") }}">

       {# 5. Der TempKey (für die Finalisierung/Cleanup) #}
       <input type="hidden"
              data-media-upload-target="tempKey"
              name="{{ options.mediaInputPrefix ? options.mediaInputPrefix ~ '[tempKey]' : 'mediaTempKey' }}"
              value="{{ options.tempKey }}">

       {# ... Modal für edit action ... #}
       {% include '@Media/_media_modal.html.twig' %}

</div>
