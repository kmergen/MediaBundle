{# _media_dashboard.html.twig #}

{# 
    WICHTIG: Wir mappen die Entities hier manuell in ein sauberes Array für JS,
    damit URL und ID sicher ankommen.
#}
{% set initialImagesData = config.images %}

{% set isAutoSave = config.autoSave|default(false) %}
{% set currentTempKey = null %}
{% if not isAutoSave %}
    {% set currentTempKey = config.tempKey|default('temp_' ~ random() ~ 'now'|date('U')) %}
{% endif %}
<div class="kmm-dashboard-container"
     data-controller="media-upload"
     data-media-upload-owner-class-value="{{ config.ownerClass }}"
     data-media-upload-owner-id-value="{{ config.ownerId|default("") }}"
     data-media-upload-context-value="{{ config.context }}"
     data-media-upload-upload-url-value="{{ path("kmergen_media_upload") }}"
     data-media-upload-reorder-url-value="{{ path("kmergen_media_reorder") }}"
     data-media-upload-delete-url-template-value="{{ path('kmergen_media_delete', {'id': 'ID_PLACEHOLDER'}) }}"
     data-media-upload-initial-images-value="{{ initialImagesData|json_encode }}"
     data-media-upload-album-id-value="{{ config.albumId|default("") }}"
     data-media-upload-auto-save-value="{{ isAutoSave }}"
     data-media-upload-temp-key-value="{{ currentTempKey }}"
     data-media-upload-image-variants-value="{{ config.imageVariants|default([]) |json_encode }}"
     data-media-upload-csrf-value="{{ csrf_token("media_delete") }}">
    <div data-media-upload-target="previewList"
         class="kmm-dashboard-preview-grid">{# JS füllt diesen Bereich basierend auf initial-images-value #}</div>

    {# 2. DROPZONE (Jetzt UNTEN, Volle Breite) #}
    <div data-media-upload-target="dropzone"
         data-action="click->media-upload#onDropzoneClick dragover->media-upload#onDragOver dragleave->media-upload#onDragLeave drop->media-upload#onDrop"
         class="kmm-dashboard-dropzone">
        <div class="kmm-dropzone-info">
            <svg class="kmm-dropzone-info-svg"
                 fill="none"
                 stroke="currentColor"
                 viewbox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12">
                </path>
            </svg>
            <p class="kmm-dropzone-info-text">Bilder hier ablegen oder klicken zum Hochladen</p>
        </div>
        <input type="file"
               data-media-upload-target="input"
               data-action="change->media-upload#onFileChange"
               multiple
               accept="image/*"
               class="hidden">
    </div>

    {# 3. HIDDEN INPUT (Umbenannt in media_ids) #}
    {#
					       Achtung: Dein Backend Controller (RoomController::edit) muss dieses Feld 
					       jetzt manuell aus dem Request lesen ($request->get('media_ids')), 
					       da es nicht mehr Teil des 'room[...]'-Forms ist.
					    #}
    <input type="hidden"
           data-media-upload-target="hiddenInput"
           name="media_ids"
           value="">
</div>
