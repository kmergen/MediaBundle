{% block main %}
	{# 
		       WICHTIG: Die data-values müssen zum Stimulus Controller passen.
		       Wir übergeben die bestehenden Bilder (falls vorhanden) als JSON für den Preload.
		    #}
	<div
		data-controller="media-upload" data-media-upload-upload-url-value="{{ uploadUrl|default(path('kmergen_media_upload')) }}" data-media-upload-list-url-value="{{ listUrl|default(path('kmergen_media_image_list')) }}" data-media-upload-preloaded-value="{{ images|default([])|json_encode }}" data-media-upload-album-id-value="{{ albumId }}" data-media-upload-target-dir-value="images/room/{{ room.id }}" data-media-upload-image-variants-value="{{ imageVariants|default([])|json_encode }}" class="space-y-4">

		{# Dropzone & Liste in einem Container #}
		<div
			class="flex gap-4 flex-wrap items-start">

			{# Die Liste der Bilder (Sortable Area) #}
			<div
				data-media-upload-target="previewList" class="image-list flex gap-4 flex-wrap">{# Bestehende Bilder werden hier via JS (Preload) oder AJAX eingefügt #}
			</div>

			{# Der Trigger für neue Uploads #}
			<div data-media-upload-target="dropzone" data-action="click->media-upload#onDropzoneClick
								                             dragover->media-upload#onDragOver
								                             dragleave->media-upload#onDragLeave
								                             drop->media-upload#onDrop" class="flex items-center justify-center w-[140px] h-[140px] border-2 border-gray-300 border-dashed rounded-lg cursor-pointer hover:bg-gray-100 transition-all">

				<input type="file" data-media-upload-target="input" data-action="change->media-upload#onFileChange" class="hidden" multiple>

				<span class="text-4xl text-gray-400">+</span>
			</div>
		</div>

		{# 
				           Dieses Hidden-Input Feld sammelt die IDs in der richtigen Reihenfolge
				           und wird mit dem Hauptformular abgeschickt.
				        #}
		<input type="hidden" name="media_ids" data-media-upload-target="hiddenInput">
	</div>
{% endblock %}
